# Nodejs 책리뷰사이트 팀프로젝트

### https://github.com/zam0ng/node-PJ.git

## 20230602

- 작가로 등록된 사람은 자신의 책을 올릴수 있고 독자들은 책에 대한 리뷰를 작성할 수 있는 사이트를 구현하기로함
- 그 중 상세페이지와 실시간 채팅 기능에 대한 구현부분을 맡음

### 금일 작업 내용

- users, books, review, r_review 테이블 생성 및 조인 sequelize js 파일 생성 후 배포

## 20230604

- chat 테이블 생성 js 작성 및 테스트 쿼리 작성

### 추후 추가 사항

- 테이블 생성 후 테스트 진행 결과 특정 유저와 어드민의 대화를 특정유저의 채팅 시간 정보를 이용하여 가져오지만 다른 유저의 대화가 사이에 껴있으면 다른 유저에 대한 어드민에 답변도 가져와 지는 현상발견
- user_name, text 컬럼 뿐만이 아닌 별도의 컬럼이 필요

## 20230605

- books 테이블 조회수 탑 5 리스트를 가져오기 위해 viewcnt 컬럼 추가
- users 테이블 컬럼 중 check 컬럼이 예약되있는 언어 이기 때문에 checks로 컬럼명 변경
- 메인 페이지 조회수 탑 5 리스트 및 별점 탑 5 리스트 정보를 가져오는 메인 페이지 구현 완료

## 20230606

- 나작작 프로젝트에 사용할 실시간 채팅 기능 관련 socket.io 개인 공부 실시
- mysql 쿼리를 sequelize로 바꾸는데 어려움이 있어 sequelize 문법에 대한 개인 공부 실시

## 20230607

- 나작작 프로젝트 상세페이지 css 작업 진행
- 별점 평균, 별점 별 평균, 유저에 대한 정보를 불러오는 기능에 대해선 내일부터 작업 진행할 예정
- position sticky 나 height:auto 설정이 되지 않은 문제가 발생하여 시간을 많이 뻇김
- -> 최상단 부모 태그 아래 태그에 display:flex를 사용하여 발생한 문제 무분별한 flex 사용을 자제 하고 display와 position에 대해 알아볼 예정

## 20230608

- 나작작 프로젝트 상세페이지 기능 구현 작업 중
- 해당 페이지의 게시글에 대한 내용 및 작가의 정보를 불러오는 sequelize 작업 진행

## 20230609

- 나작작 프로젝트 상세페이지 기능 구현 작업 중
- 상세페이지 별점, 댓글수, 작성 글 정보 불러오기, 작가 정보 불러오기, 댓글 쓰기, 리뷰 통계 그래프 기능 구현 완료
- 해당 글에 있는 댓글을 작성한 닉네임 정보를 가져와 users 테이블에 접근하려 할때 계속 글쓴 작가의 정보만 가져와짐
- -> 테이블에 조인 조건에 의해 안되는거 같음 테이블 수정필요
- -> review 테이블에 유저 프로필 이미지등 간단한 정보를 추가해도 문제는 해결됨

## 20230610

- 나작작 프로젝트 상세페이지 댓글쓴 사람 프로필 불러오는 쿼리 테스트
- 대댓글은 버튼을 누르면 보여지게끔 css 변경

## 20230611

- 나작작 프로젝트 상세페이지 버그 수정 및 데이터베이스 변경
- 데이터베이스 users 테이블과 review 테이블을 조인 시키기 위해 models 조인조건 추가
- 추가 후 테스트를 하기 위해 테스트 데이터를 넣는 도중 별점 정보가 아예 없거나 비어 있을때 생기는 버그 발견

---

> 별점 정보가 아예 없을때

- 새로 등록한 책의 경우 별점 및 댓글 정보가 아무것도 없을 수 있음
- 별점에 대한 정보가 없을 경우 모든 경우의 수를 0으로 하는 기능 추가
  > 별점이 중간에 비는 경우
- 별점이 5,3,1 각 1개씩 있다고 가정했을때 4,2 에 대한 별점정보가 비게되는데 별점 통계에서는 5,4,3,2,1 순으로 별점을 가져와 그래프를 그려주는데 3개의 데이터만 들어오기 때문에 위에서 부터 3개 데이터 입력후 나머지 2개는 undefined
- 무조건 5번 동작하는 for문을 추가하여 비어있는 별점에 0을 추가함

## 20230612

- 나작작 프로젝트 상세페이지 버그 수정 및 데이터베이스 변경
- review 테이블과 users 테이블 연결 후 review는 사용자 이미지를 불러와 졌지만 r_review 즉 대댓글 기능에 유저 이미지가 불러와지지 않아 users 테이블과 r_review 테이블 조인 조건 추가
- 별점 점수가 어제 테스트했을때는 몰랐는데 여러개가 비었을때 다른 버그가 발생함
- 1,2,3,4,5 가 전부 들어있는 배열을 미리 만들어두고 넘어온 별점의 길이가 5가 아니면 미리 만들어 둔 배열에 넘어온 데이터를 삽입 하는 식으로 수정
- 대댓글 comment 버튼 누르면 보였다 안보였다 하게 작업 중

## 20230613

- 나작작 프로젝트 상세페이지 작업
- 댓글 및 대댓글 기능 별점 통계 기능 구현완료
- 다른 페이지와 merge 작업 중 전체 목록에서 해당 게시물로 넘어갈때 게시물의 id값을 넘겨주는 작업 필요
- -> id를 넘길때 a 태그 뒷부분에 id값을 입력해서 넘김
- 예를들어 http://127.0.0.1:5500/view.html?id=1 이렇게 작성하면
- const getUrl = new URL(window.location.href);
- const getParams = new URLSearchParams(getUrl.search);
- const getId = getParams.get("id");
- 이런식으로 현재 url에 입력되어있는 id의 값을 가져올 수 있음
  > axios get과 post
- 단순 get은 검색만 할때 post는 수정만 할때라고 생각해서 사용했는데 너무 포괄적으로 이해한거 같음
- insert하기 위해 post를 사용했는데 데이터가 넘어가지 않고 get으로 했을때 넘어가길래 뭔가 싶어 찾아보니 get 요청 할때 데이터를 params에 담아 보냈을땐 잘되고 post는 안되는 차이가 있어 찾아 보니 post는 본문에 데이터를 담기 때문에 바로 보내닌까 됬음
- 그렇게 해서 get에선 req.query로 post에선 req.body로 데이터를 받음
- 그리고 post에서는 첫 번째 매개변수가 요청URL 두번째 매개변수가 요청 본문, 세번째 매개변수는 요청에 대한 설정을 정의 하는 곳이기 때문에 'withCredentials: true'은 3번째 매개변수에 위치 시켜야 한다
- 이렇게 하지않으면 rawHeader에 쿠키값이 넘어가지않음

## 20230614

- 나작작 프로젝트 로그인, 메인페이지, 장르페이지, 상세페이지
  > 로그인 페이지
- 로그인 페이지 아이디나 비밀번호를 입력안했을때 경고 문구 띄우기

> 메인페이지

- 조회수 및 별점 순으로 보이는 책 클릭했을때 상세페이지에서 해당 책의 내용 보여주는 기능 추가

> 장르페이지

- 책 클릭했을때 상세페이지로 이동하고 이동할때 책의 내용을 보여주게 하는 기능 추가

> 상세페이지

- 로그인한 유저가 상세페이지에서 로그아웃했을때 문제 해결
- -> 무조건 로그인 한 유저의 정보를 불러오게 해뒀기때문에 로그인한 유저정보가 있는지 검증하는 절차 추가

## 20230615

- 나작작 프로젝트 상세페이지, 채팅
- branch merge 후 자잘한 버그들이 많이 생김
- 예) 댓글을 등록하면 별점 총점이 바뀌고 댓글이 써져야 하는데 2번 써야 적용되는 등 의 버그들
- 별점 총점, 대댓글이 공유되는 문제, 로그인 하지 않은 회원이 접근했을때 문제 해결
- 찜기능 추가 작업 진행 중

## 20230616

- 나작작 프로젝트 채팅 기능 구현 시작
- 채팅관련 css 작업 및 소켓 부분 구현 시작
- 현재 로그인 한 유저와 어드민간의 대화부분만 구현 중

## 20230617

- 나작작 프로젝트 채팅 기능 구현
- 운영자와 특정 유저간 채팅 기능 구현 완료 데이터베이스에 저장되는거 확인
- 추후 css 적용하여 관리자가 쓴 글과 유저가 쓴글 정렬하는 방법 구상해봐야함
- 다음 작업 간 css 합칠 예정

## 202306018

- 나작작 프로젝트 채팅 기능 구현
- 사용자 채팅 기능 구현 (데이터베이스에 운영자와 대화내용 들어가는거 확인)
- 스크롤이 안생기는 문제 해결중

## 20230619

- 나작작 프로젝트 사용자 채팅 기능 구현
- 사용자 채팅 기능 및 css 완료
- 결제 관련 작업 진행 예정(카카오결제 api를 사용할 예정)

## 20230620

- 나작작 프로젝트 결제 기능 구현
- 현재 카카오페이 api를 사용하여 테스트 환경에서 mvc 모델로 테스트 결제까지 완료
- 내일 상세페이지에 결제 기능 추가 및 테이블에 price 컬럼 추가하여 작업 진행할 예정

## 20230621

- 나작작 프로젝트 결제 기능 구현 및 오류 수정 작업 진행
- 카카오페이 api를 활용한 테스트 결제 구현 완료
- 기능은 마무리하고 배포 하기 위한 merge 작업 진행 중 다수의 오류 발생
- 현재 merge 후 오류 내용 파악하여 페이지별로 버그 수정 후 다시 merge 할 예정
- 댓글 삭제 기능 및 follow 수 표시 등 작업 진행할 예정

## 20230622

- 나작작 프로젝트 merge 후 오류 및 버그 수정 부분 작업 진행
- 댓글을 작성하는 조건 수정
- 기존 댓글을 여러게 쓸 수 있었지만 댓글을 쓸 수 있는 조건을 책을 구매한 사람만 달 수 있게 설정하였고 댓글 갯수는 3개로 제한
- 다시 merge 작업 진행 후 배포 테스트

## 20230623

- 나작작 프로젝트 merge 후 오류 및 버그 수정 및 댓글 삭제 기능 구현
- 댓글을 로그인 하지 않은 인원이 지우려고 시도했을 경우 차단 및 글을 쓴 사람이 댓글을 지울때 댓글을 삭제 하는 기능 추가
- cascade를 추가하여 댓글 삭제시 대댓글까지 삭제 되게 설정
- read more 기능을 추가하여 댓글이 10개 이상일때 10개씩 보여주는 기능 구현할 예정

## 20230624

- 나작작 프로젝트 상세페이지 readmore 기능 추가
- 댓글을 총 10개씩 보여주는 기능 구현
- 버그 수정 및 merge 작업 진행
- 발표 자료 준비를 위한 작업 사항 정리
